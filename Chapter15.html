<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Simple Enemy | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="./Chapter17.html" />
    
    
    <link rel="prev" href="./Chapter13.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="12" data-basepath="." data-revision="Sun Sep 27 2015 07:44:13 GMT-0700 (Pacific Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Chapter1.html">
            
                
                    <a href="./Chapter1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Starting Out
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="FrameworksSources.html">
            
                
                    <a href="./FrameworksSources.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Managers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Game.html">
            
                
                    <a href="./Game.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Game
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Program.html">
            
                
                    <a href="./Program.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Program
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Chapter2.html">
            
                
                    <a href="./Chapter2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Why Tiles?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Chapter3.html">
            
                
                    <a href="./Chapter3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Map Format
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Chapter6.html">
            
                
                    <a href="./Chapter6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Creating Tiles
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Practice/PracticeCh6.html">
            
                
                    <a href="./Practice/PracticeCh6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Chapter5.html">
            
                
                    <a href="./Chapter5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Map Tools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Chapter8.html">
            
                
                    <a href="./Chapter8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        The Hero
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Practice/PracticeTheHero.html">
            
                
                    <a href="./Practice/PracticeTheHero.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Chapter9.html">
            
                
                    <a href="./Chapter9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Keys To Move
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Practice/PracticeMoving.html">
            
                
                    <a href="./Practice/PracticeMoving.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Chapter10.html">
            
                
                    <a href="./Chapter10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Hit The Wall
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Chapter11.html">
            
                
                    <a href="./Chapter11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Open The Door
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="cleanup.html">
            
                
                    <a href="./cleanup.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Cleaning Up
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="borders.html">
            
                
                    <a href="./borders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Screen Borders
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Chapter12.html">
            
                
                    <a href="./Chapter12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Jumping
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="jumpconfig.html">
            
                
                    <a href="./jumpconfig.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Configurable Jumping
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="Chapter13.html">
            
                
                    <a href="./Chapter13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Clouds
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="12" data-path="Chapter15.html">
            
                
                    <a href="./Chapter15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Simple Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Chapter17.html">
            
                
                    <a href="./Chapter17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Shooting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="Chapter18.html">
            
                
                    <a href="./Chapter18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Getting Items
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="Chapter20.html">
            
                
                    <a href="./Chapter20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Scrolling
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="15.1" data-path="Chapter21.html">
            
                
                    <a href="./Chapter21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.1.</b>
                        
                        Limit Scrolling
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="16" data-path="Chapter22.html">
            
                
                    <a href="./Chapter22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Depth
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="16.1" data-path="SpeerateCollisionAndRendering.html">
            
                
                    <a href="./SpeerateCollisionAndRendering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.1.</b>
                        
                        Collision &amp; Rendering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.2" data-path="AddingAHouse.html">
            
                
                    <a href="./AddingAHouse.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.2.</b>
                        
                        Visual Tweaks
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.3" data-path="DepthBuffer.html">
            
                
                    <a href="./DepthBuffer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.3.</b>
                        
                        Depth Buffer
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="17" data-path="Chapter23.html">
            
                
                    <a href="./Chapter23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Ismetric View
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="17.1" data-path="Iso_MakeMap.html">
            
                
                    <a href="./Iso_MakeMap.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.1.</b>
                        
                        Map
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17.2" data-path="Iso_MakeCharacters.html">
            
                
                    <a href="./Iso_MakeCharacters.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.2.</b>
                        
                        Characters
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17.3" data-path="Iso_MakeItems.html">
            
                
                    <a href="./Iso_MakeItems.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.3.</b>
                        
                        X Items &amp; Projectiles
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="18" data-path="Chapter24.html">
            
                
                    <a href="./Chapter24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        X Mouse To Move
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="Chapter25.html">
            
                
                    <a href="./Chapter25.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        X Iso Mouse
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="Chapter26.html">
            
                
                    <a href="./Chapter26.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        X Iso Scroll
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="Chapter29.html">
            
                
                    <a href="./Chapter29.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        X Slopes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="Chapter30.html">
            
                
                    <a href="./Chapter30.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        X Hexagons
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="Chapter7.html">
            
                
                    <a href="./Chapter7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        X More Tiles
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="simple-enemy">Simple Enemy</h1>
<p>Having a game where your hero is in an empty room is not much fun! Let&apos;s add some enemies to the game! For now they are going to be simple enemies, mario style. The enemy will spawn and start walking. It will walk until it hits a wall, then turn around. If at any point the enemy touches the player, the player dies. Just like mario.</p>
<h3 id="the-plan">The Plan</h3>
<p>How will this work? First off, we need to make an <code>EnemyCharacter</code> class. Games have multiple <code>EnemyCharacter</code> classes, one for each type of enemy. So for zelda you might have <strong>MoblinEnemyCharacter</strong>, <strong>ChompChompEnemyCharacter</strong>, <strong>ChickenEnemyCharacter</strong> and so on. We are only going to have one enemy class for now <code>EnemyCharacter</code>. </p>
<p>So, where do enemies go? Right now the <code>Game</code> owns the <code>PlayerCharacter</code>. Can we just put an enemy array in <code>Game</code>? Not really. Because our game has multiple rooms (or levels, whatever we are calling them), each room has it&apos;s own set of enemies. If you are in <code>Room1</code> then the enemies in <code>Room2</code> should not update or render! Therefore it makes sense to add a <code>EnemyCharacter</code> array inside of the <code>Map</code> class.</p>
<p>Now that map has a list of enemy characters it&apos;s going to need an update method. It needs this so the enemies can update themselves. It would also make sense to check for player collision in here! Instead of the player having to know about all the enemies, we just mape the map know about the player. Because map knows about the enemies and the player it&apos;s trivial to check for collision in there.</p>
<p>Finally, we need to add a game over state. This is going to be a simple bool in the <code>Game</code> class that controls what text we see on screen.</p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>SimpleEnemy</strong> and get this project up to par with the cleaned up version of the <strong>OpenTheDoor</strong> section of the writeup. We&apos;re going to work from here.</p>
<h3 id="character-refactor">Character refactor</h3>
<p>Before creating the enemy class we need to refactor the <code>Character</code> and <code>PlayerCharacter</code> classes a bit. Right now all of the animation code is in <code>PlayerCharacter</code> seeing how both the player and the enemy will animate, we should move this functionality into the <strong>Character</strong> class.</p>
<p>The collision handling code is also all in <code>PlayerCharacter</code>, and both player and enemy are going to collide with the wall, but for now we&apos;re going to duplicate the collision code across these two classes.</p>
<p>This refactor is super simple. Take the <strong>Animate</strong> method from <code>PlayerCharacter</code> and move it into <code>Character</code>. Next take the <strong>animFPS</strong> and <strong>animTimer</strong> variables and also move them into <code>Character</code>. That&apos;s it. The animation code is now shared for all characters!</p>
<p><strong>Run the game</strong>, everything should work like before.</p>
<h3 id="creating-enemycharacter">Creating EnemyCharacter</h3>
<p>The enemy characters are going to be simple. They are either going to move up or down. They are going to start walking and keep walking until they hit a wall. Once they hit a wall they are going to change direction. This is about as easy as you can get with an enemy, coincidentally most enemies in Super Mario work like this.</p>
<p>Add a new file, let&apos;s call it <strong>EnemyCharacter.cs</strong>, in it make the <code>EnemyCharacter</code> class a child class of <code>Character</code> (Just like PlayerCharacter is a subclass of Character). Add three variables to this new class:</p>
<ul>
<li>float <strong>speed</strong> = 60.0f;<ul>
<li>Determines how fast an enemy walks. Measured in pixels per second. </li>
<li>The player moves at 90, so the enemies are a little slower.</li>
<li>60 pixels per second on a 30 pixel grid means enemies move 2 tiles / second</li>
</ul>
</li>
<li>bool <strong>moveUpDown</strong> = false;<ul>
<li>If true, the enemy will move in an up and down direction</li>
<li>If false, the enemy will move in a left to right direction</li>
</ul>
</li>
<li>float <strong>direction</strong> = 1.0f;<ul>
<li>Multiplies speed to determine which direction the enemy walks </li>
<li>If positive the enemy will move down or right</li>
<li>If negative the enemy will move up or left</li>
</ul>
</li>
</ul>
<p>The <strong>Constructor</strong> for the enemy class is trivial, it does almost exactly what the Player constructor does. The only exception is the last argument that determines if the enemy is moving up/down or left/right. Also note, the sprite positions are different, i looked these values up using Paint.Net for you.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">EnemyCharacter</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> spritePath, Point pos, <span class="hljs-keyword">bool</span> movingUpDown</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">spritePath, pos</span>) </span>{
    AddSprite(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">68</span>, <span class="hljs-number">112</span>, <span class="hljs-number">29</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">101</span>, <span class="hljs-number">112</span>, <span class="hljs-number">29</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Up&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">134</span>, <span class="hljs-number">112</span>, <span class="hljs-number">30</span>, <span class="hljs-number">29</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">167</span>, <span class="hljs-number">112</span>, <span class="hljs-number">30</span>, <span class="hljs-number">29</span>));
    AddSprite(<span class="hljs-string">&quot;Left&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">1</span>, <span class="hljs-number">113</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">34</span>, <span class="hljs-number">112</span>, <span class="hljs-number">30</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Right&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">201</span>, <span class="hljs-number">112</span>, <span class="hljs-number">30</span>, <span class="hljs-number">29</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">234</span>, <span class="hljs-number">113</span>, <span class="hljs-number">30</span>, <span class="hljs-number">29</span>));
    SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);

    moveUpDown = movingUpDown;
    <span class="hljs-keyword">if</span> (!moveUpDown) {
        SetSprite(<span class="hljs-string">&quot;Right&quot;</span>);
    }
}
</code></pre>
<p>The <strong>Update</strong> method for the enemy is very important. It animates the enemy, moves the enemys position and handles wall collisions. Let&apos;s write all of this in one go. I&apos;m going to start you off with a template of the update function that animates and moves the enemy:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>) </span>{
    Animate(deltaTime);

    <span class="hljs-keyword">if</span> (moveUpDown) {
        <span class="hljs-comment">// Direction is VERY important here. If it&apos;s positive the enemy moves up.</span>
        <span class="hljs-comment">// If its negative the player moves down. This happens because direction can</span>
        <span class="hljs-comment">// only be 1 or -1, so the code essentially translates to:</span>
        <span class="hljs-comment">// y += +(speed * delta) OR y += -(speed * delta)</span>
        <span class="hljs-comment">// depending on the value of direction. Nifty! </span>
        <span class="hljs-comment">// The alternate to this is to add a bunch of bools (movingLeft, movingRight, etc...)</span>
        <span class="hljs-comment">// and flip them during collisions and add or subtract from y based on those bools</span>
        <span class="hljs-comment">// The bool approach is obviously aweful! Just multiplying a positive or -1 is very elegant.</span>
        <span class="hljs-comment">// Remember this trick, it&apos;s going to save you so many if statements down the line.</span>
        Position.Y += direction * speed * deltaTime;

        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Handle wall collision (4 possible collisions)</span>
    }
    <span class="hljs-keyword">else</span> {
        Position.X += direction * speed * deltaTime;
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Handle wall collision (4 possible collisions)</span>
    }
}
</code></pre>
<p>This enemy is taking shape niceley! If we where to add him to the game right now it would just start walking in a direction and never stop. All we have to do is add wall collision and we are done with the enemy class. Lickly we have a template for collision code! We wrote all collision cases for the player class, all we have to do is copy them over and modify them slightly. I&apos;ll get you started with an example. Let&apos;s look at what the player character does when the up button is pressed:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (i.KeyDown(OpenTK.Input.Key.W) || i.KeyDown(OpenTK.Input.Key.Up)) {
    SetSprite(<span class="hljs-string">&quot;Up&quot;</span>);
    Animate(deltaTime);
    Position.Y -= speed * deltaTime;
    <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
        Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
        <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
            Position.Y = intersection.Bottom;
        }
    }
    <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_RIGHT]).Walkable) {
        Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_RIGHT]));
        <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
            Position.Y = intersection.Bottom;
        }
    }
}
</code></pre>
<p>This is more than what we need. We don&apos;t care about keyboard input, and we already took care of moving. All we really need out of that top blob is the collision code, like so:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
    Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
    <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
        Position.Y = intersection.Bottom;
    }
}
<span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_RIGHT]).Walkable) {
    Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_RIGHT]));
    <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
        Position.Y = intersection.Bottom;
    }
}
</code></pre>
<p>This is checking for the TOP collision. Meaning if the enemy is walking upwards he will hit the wall and not do anything, just keep walking into the wall. But hey at least there is collision and he won&apos;t walk off the screen! Let&apos;s add code in there to flip the enemy direction:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
    Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
    <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
        Position.Y = intersection.Bottom;
        direction = <span class="hljs-number">1.0</span>f;
        SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
    }
}
<span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_RIGHT]).Walkable) {
    Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_RIGHT]));
    <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
        Position.Y = intersection.Bottom;
        direction = <span class="hljs-number">1.0</span>f;
        SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
    }
}
</code></pre>
<p>Our update method should look like this now:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>) </span>{
    Animate(deltaTime);

    <span class="hljs-keyword">if</span> (moveUpDown) {
        <span class="hljs-comment">// Direction is VERY important here. If it&apos;s positive the enemy moves up.</span>
        <span class="hljs-comment">// If its negative the player moves down. This happens because direction can</span>
        <span class="hljs-comment">// only be 1 or -1, so the code essentially translates to:</span>
        <span class="hljs-comment">// y += +(speed * delta) OR y += -(speed * delta)</span>
        <span class="hljs-comment">// depending on the value of direction. Nifty! </span>
        <span class="hljs-comment">// The alternate to this is to add a bunch of bools (movingLeft, movingRight, etc...)</span>
        <span class="hljs-comment">// and flip them during collisions and add or subtract from y based on those bools</span>
        <span class="hljs-comment">// The bool approach is obviously aweful! Just multiplying a positive or -1 is very elegant.</span>
        <span class="hljs-comment">// Remember this trick, it&apos;s going to save you so many if statements down the line.</span>
        Position.Y += direction * speed * deltaTime;

        <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
            Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
            <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
                Position.Y = intersection.Bottom;
                direction = <span class="hljs-number">1.0</span>f;
                SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
            }
        }
        <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_RIGHT]).Walkable) {
            Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_RIGHT]));
            <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
                Position.Y = intersection.Bottom;
                direction = <span class="hljs-number">1.0</span>f;
                SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
            }
        }
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Bottom collision (2 if statements)</span>
    }
    <span class="hljs-keyword">else</span> {
        Position.X += direction * speed * deltaTime;
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Left collision (2 if statements)</span>
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Right collision (2 if statements)</span>
    }
}
</code></pre>
<p>Go ahead and fill out the collision for the other directions of the enemy. Unfortunitaley we can&apos;t test our progress at this point as we havent added any enemies to the game yet. Lets go ahead and fix that!</p>
<h3 id="refactoring-map">Refactoring Map</h3>
<p>Inside of <strong>Map.cs</strong> add a new <code>List</code> of enemies to the <code>Map</code> class. We are going to use a list, not an array because we don&apos;t know in advance how many enemies a map will contain.</p>
<p>Let&apos;s add a new function to <code>Map</code>, we&apos;re going to call this function <code>AddEnemy</code> all it&apos;s going to do is add a new enemy to the enemy list. It&apos;s as straight forward as things get. This will allow us to add enemies to a room even at runtime! So if the player trips a trap an enemy can spawn.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">AddEnemy</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> spritePath, Point pos, <span class="hljs-keyword">bool</span> movingUpDown</span>) </span>{
    enemies.Add(<span class="hljs-keyword">new</span> EnemyCharacter(spritePath, pos, movingUpDown));
}
</code></pre>
<p>Update the <strong>Render</strong> method of <code>Map</code> to loop trough all the enemies and call <code>Render</code> on them.</p>
<p>Update the <strong>Destroy</strong> method of <code>Map</code> to loop trough all the enemies and call <code>Destroy</code> on them.</p>
<p>Add a new <strong>Update</strong> method to <code>Map</code>, it should take a <code>float</code> as an argument (<code>delatTime</code>). In the new <code>Update</code> method loop trough all the enemies and call <code>Update</code> on them.</p>
<p>That&apos;s it for now. This is the minimum ammount of code we need to add to support enemies. We will add player collision soon, but first let&apos;s get to a state where we can visually confirm that the enemies are working.</p>
<h3 id="refactoring-game">Refactoring Game</h3>
<p>We added a <strong>Update</strong> method to <code>Map</code>. Make sure to call <code>Udpate</code> on the <strong>currentRoom</strong> in the <code>`Game</code> class. Let&apos;s add a new constant to game:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">string</span> npsSheet = <span class="hljs-string">&quot;Assets/NPC.png&quot;</span>;
</code></pre>
<p>It&apos;s a good idea to make all commonly used strings, integers and other constants into variables. This way if you decide that ALL NPC characters should use &quot;Assets/Baddies.png&quot; later, you only have to change the path in one place instead of tracking down every occurance of the old string.</p>
<p>Now, inside of <strong>Initialize</strong>, let&apos;s add a couple of enemies:</p>
<pre><code class="lang-cs">room1.AddEnemy(npsSheet, <span class="hljs-keyword">new</span> Point(<span class="hljs-number">6</span> * <span class="hljs-number">30</span>, <span class="hljs-number">1</span> * <span class="hljs-number">30</span>), <span class="hljs-keyword">true</span>);
room2.AddEnemy(npsSheet, <span class="hljs-keyword">new</span> Point(<span class="hljs-number">1</span> * <span class="hljs-number">30</span>, <span class="hljs-number">4</span> * <span class="hljs-number">30</span>), <span class="hljs-keyword">false</span>);
</code></pre>
<p>That should to it. Run the game and you should see this:</p>
<p><img src="Images/simple_enemy.png" alt="DEMO"></p>
<p>They don&apos;t do much yet, but the enemies should walk until they hit a wall and then turn around.</p>
<h3 id="loosing-the-game">Loosing the game</h3>
<p>Before adding collision to the player and enemy, let&apos;s add support for loosing the game to <strong>Game.cs</strong>. Add a new member variable, call it <strong>GameOver</strong> with a default state of false. This new variable should be public! Change the update method to respect this new variable.</p>
<p>In <strong>Update</strong>, if <code>GameOver</code> is true check to see if the space key was pressed. If the space key was pressed:</p>
<ul>
<li>Set game over to false</li>
<li>Set currentMap to room1</li>
<li>Set the hero position X to be at the spawn tile</li>
<li>Set the hero position y to be at the spawn tile</li>
</ul>
<p>else (if wame over was false) update the game like normal. Let&apos;s also update the Render method, if GameOver is true it should print a game over message over the existing screen. By not updating the game state, but still rendering it, we make it look like the game gets paused when there is a game over. It&apos;s a cool effect. Here is what the render should look like:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span>) </span>{
    currentMap.Render();
    hero.Render();

    <span class="hljs-keyword">if</span> (GameOver) {
        GraphicsManager.Instance.DrawRect(<span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">0</span>, <span class="hljs-number">70</span>, <span class="hljs-number">240</span>, <span class="hljs-number">50</span>), Color.CadetBlue);

        GraphicsManager.Instance.DrawString(<span class="hljs-string">&quot;Game Over&quot;</span>, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">70</span>, <span class="hljs-number">80</span>), Color.Black);
        GraphicsManager.Instance.DrawString(<span class="hljs-string">&quot;Game Over&quot;</span>, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">69</span>, <span class="hljs-number">79</span>), Color.White);

        GraphicsManager.Instance.DrawString(<span class="hljs-string">&quot;Press Space to play again&quot;</span>, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">5</span>, <span class="hljs-number">96</span>), Color.Black);
        GraphicsManager.Instance.DrawString(<span class="hljs-string">&quot;Press Space to play again&quot;</span>, <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">4</span>, <span class="hljs-number">95</span>), Color.White);

    }
}
</code></pre>
<h3 id="enemy-collision">Enemy collision</h3>
<p>Working in <strong>Map.cs</strong>. Let&apos;s update the <strong>Update</strong> method of the <code>Map</code> class to check for collision against the player.</p>
<p>First, add a new argument to the Update method, it should be of type <code>PlayerCharacter</code>.  Next, after updating the enemy check if it collides with the player. If it does use the <code>Game</code> singleton to set <code>GameOver</code> to true. </p>
<p>How do we check if a player an an enemy collide? Both classes inherit the <code>Rect</code> getter from <code>Character</code> which returns their bounding rectangle. Check if the bounding rectangles intersection area is greater than 0. If it is, an intersection has happened.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> dt, PlayerCharacter hero</span>) </span>{
    <span class="hljs-keyword">foreach</span> (EnemyCharacter enemy <span class="hljs-keyword">in</span> enemies) {
        enemy.Update(dt);

        Rectangle intersection = Intersections.Rect(enemy.Rect, hero.Rect);
        <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) {
            Game.Instance.GameOver = <span class="hljs-keyword">true</span>;
        }
    }
}
</code></pre>
<p>Don&apos;t forget to add the exta argument to the function call in <strong>Game.cs</strong>. This is what my entire Update for Game looks like:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> dt</span>) </span>{
    <span class="hljs-keyword">if</span> (GameOver) {
        <span class="hljs-keyword">if</span> (InputManager.Instance.KeyPressed(OpenTK.Input.Key.Space)) {
            GameOver = <span class="hljs-keyword">false</span>;
            currentMap = room1;
            hero.Position.X = spawnTile.X * <span class="hljs-number">30</span>;
            hero.Position.Y = spawnTile.Y * <span class="hljs-number">30</span>;
        }
    }
    <span class="hljs-keyword">else</span> {
        currentMap = currentMap.ResolveDoors(hero);
        currentMap.Update(dt, hero);
        hero.Update(dt);
    }
}
</code></pre>
<p>Run the game and walk into an enemy, you should see a game over message, and pressing space should let you start playing again!</p>
<p><img src="Images/wompwomp.PNG" alt="GameOver"></p>
<p>Thats it! We now have support for simple enemies!</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./Chapter13.html" class="navigation navigation-prev " aria-label="Previous page: Clouds"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./Chapter17.html" class="navigation navigation-next " aria-label="Next page: Shooting"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
