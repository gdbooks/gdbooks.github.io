<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Collision &amp; Rendering | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="./DepthBuffer.html" />
    
    
    <link rel="prev" href="./Chapter22.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="16.1" data-basepath="." data-revision="Wed Sep 23 2015 03:27:38 GMT-0700 (Pacific Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Chapter1.html">
            
                
                    <a href="./Chapter1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Starting Out
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="FrameworksSources.html">
            
                
                    <a href="./FrameworksSources.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        Managers
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Game.html">
            
                
                    <a href="./Game.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        Game
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="Program.html">
            
                
                    <a href="./Program.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        Program
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Chapter2.html">
            
                
                    <a href="./Chapter2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Why Tiles?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Chapter3.html">
            
                
                    <a href="./Chapter3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Map Format
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Chapter6.html">
            
                
                    <a href="./Chapter6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Creating Tiles
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Practice/PracticeCh6.html">
            
                
                    <a href="./Practice/PracticeCh6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Chapter5.html">
            
                
                    <a href="./Chapter5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Map Tools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Chapter8.html">
            
                
                    <a href="./Chapter8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        The Hero
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Practice/PracticeTheHero.html">
            
                
                    <a href="./Practice/PracticeTheHero.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Chapter9.html">
            
                
                    <a href="./Chapter9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Keys To Move
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Practice/PracticeMoving.html">
            
                
                    <a href="./Practice/PracticeMoving.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Chapter10.html">
            
                
                    <a href="./Chapter10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Hit The Wall
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Chapter11.html">
            
                
                    <a href="./Chapter11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Open The Door
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="cleanup.html">
            
                
                    <a href="./cleanup.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Cleaning Up
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="borders.html">
            
                
                    <a href="./borders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Screen Borders
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Chapter12.html">
            
                
                    <a href="./Chapter12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Jumping
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="jumpconfig.html">
            
                
                    <a href="./jumpconfig.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Configurable Jumping
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="Chapter13.html">
            
                
                    <a href="./Chapter13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Clouds
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="Chapter15.html">
            
                
                    <a href="./Chapter15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Simple Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Chapter17.html">
            
                
                    <a href="./Chapter17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Shooting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="Chapter18.html">
            
                
                    <a href="./Chapter18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Getting Items
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="Chapter20.html">
            
                
                    <a href="./Chapter20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Scrolling
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="15.1" data-path="Chapter21.html">
            
                
                    <a href="./Chapter21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.1.</b>
                        
                        Limit Scrolling
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="16" data-path="Chapter22.html">
            
                
                    <a href="./Chapter22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Depth
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="16.1" data-path="SpeerateCollisionAndRendering.html">
            
                
                    <a href="./SpeerateCollisionAndRendering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.1.</b>
                        
                        Collision &amp; Rendering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.2" data-path="DepthBuffer.html">
            
                
                    <a href="./DepthBuffer.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.2.</b>
                        
                        X Depth Buffer
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16.3" data-path="PaintersAlgorithm.html">
            
                
                    <a href="./PaintersAlgorithm.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.3.</b>
                        
                        X Painters algorithm
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="17" data-path="Chapter23.html">
            
                
                    <a href="./Chapter23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        X Ismetric View
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="Chapter24.html">
            
                
                    <a href="./Chapter24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        X Mouse To Move
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="Chapter25.html">
            
                
                    <a href="./Chapter25.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        X Iso Mouse
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="Chapter26.html">
            
                
                    <a href="./Chapter26.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        X Iso Scroll
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="Chapter27.html">
            
                
                    <a href="./Chapter27.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        X Rotating Hero
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="Chapter28.html">
            
                
                    <a href="./Chapter28.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        X Rotating Ground
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="Chapter29.html">
            
                
                    <a href="./Chapter29.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        X Slopes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="Chapter30.html">
            
                
                    <a href="./Chapter30.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        X Hexagons
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="Chapter7.html">
            
                
                    <a href="./Chapter7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        X More Tiles
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="seperating-collision-rendering">Seperating Collision &amp; Rendering</h1>
<p>The first thing we need to do in order to add depth to our game is to seperate the collision rectangle of characters and tiles from their rendering. This will give us the unsorted illusion of depth. By the end of this chapter we want to achieve this effect (Note how links head is above the tile):</p>
<p><img src="Images/depth_effect.PNG" alt="DEPTH"></p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>DepthBase</strong> and get this project up to par with the <strong>LimitedScrolling</strong> section of the writeup. We&apos;re going to work from here.</p>
<h2 id="character">Character</h2>
<p>We&apos;re going to start by changing the scrolling behaviour of the character class. Starting with the character is nice, we get the effects of it applied to both the player character and enemy character! We&apos;re only going to add depth on the Y axis for now, it&apos;s rare to see depth on the X axis.</p>
<p>We are going to hard code the height of the character to some constant number (In this example 20px). Whenever the corners or bounding rectangle of the character is requested we&apos;re going to change the return to have 20 hard coded to it. Then we&apos;re going to change the render function, we&apos;re going to change it to render the sprite at Position.Y - 20 instead of Position.Y.</p>
<p>These changes will cause a 20px gap at the top of our characters. This part of the sprite will still be drawn, but it won&apos;t be taken into collision calculations. I made a graphic atempting to describe what we will be doing:</p>
<p><img src="Images/depth_explained.png" alt="DEPTH_EXPLAINED"></p>
<h3 id="debug-rendering">Debug Rendering</h3>
<p>Before we start coding anything, let&apos;s make our lives easyer by adding a little debug indicator to the <code>Character</code> class. At the end of the <strong>Render</strong> function, add this bit of code:</p>
<pre><code>// Get a 3x3 rectangle, centered on the top left pixel
Rectangle positionLocator = new Rectangle((int)Position.X - 1, (int)Position.Y - 1, 3, 3);
// Apply camera offset
positionLocator.X -= (int)offsetPosition.X;
positionLocator.Y -= (int)offsetPosition.Y;
// Draw indicator
GraphicsManager.Instance.DrawRect(positionLocator, Color.Yellow);
</code></pre><p>This should draw a 3x3 yellow rectangle centered at the top left pixel of the character. If you run your game you should see this:</p>
<p><img src="Images/topleft_pixel.png" alt="TOP_LEFT"></p>
<h3 id="applying-depth">Applying Depth</h3>
<p>First, we have to add a new member variable to the <code>Character</code> class. Make it a protected <strong>float</strong> and call it <code>Height</code>. Set it to <strong>-1</strong> by default. If the new variable is less than 0 we will not apply the depth effect to the character, if it is greater than 0 we will apply a depth effect.</p>
<p>Next, change the constructor of character, it should now take in a third argument, a float called height. Set the member variable accordingly. Since we changed the constructor, we need to change where the constructor gets called. Find the following code in both <code>PlayerCharacter</code> and <code>EnemyCharacter</code>:</p>
<pre><code class="lang-cs">: <span class="hljs-keyword">base</span>(spritePath, pos) {
</code></pre>
<p>In <code>PlayerCharacter</code> pass <strong>20</strong> as the third argument, in <code>EnemyCharacter</code> pass <strong>-1</strong> as the third argument. By using constants as the last argument of the base constructor we can avoid changing the constructor of <code>PlayerCharacter</code> and <code>EnemyCharacter</code>. Needless to say, the player will have a depth effect, while the enemy will not.</p>
<p>Change the <strong>Rect</strong> getter in the <code>Character</code> class. If the new <code>Height</code> variable is &gt;= 0, set the returned rectangles height to the varaible.</p>
<p>Change the <strong>Corners</strong> getter. Right now it uses this bit of code to add height to corners <code>SpriteSources[currentSprite][currentFrame].Height</code>, if the new <code>Height</code> variable is &gt;= 0, use the <code>Height</code> variable, if it&apos;s less than 0 keep using what was already there.</p>
<p>Finally, change the <strong>Render</strong> function. After subtracting <code>offsetPosition</code> from <code>renderPosition</code>, if the new <code>Height</code> variable is &gt;= 0 find the height difference of the frame height and the hard coded height:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">int</span> difference = SpriteSources[currentSprite][currentFrame].Height - (<span class="hljs-keyword">int</span>)Height;
</code></pre>
<p>and subtract it from from <code>renderPosition.Y</code>. That should do it. <strong>Run the game</strong> and you should be able to walk up to walls and overlap them a bit. Links head should be above the yellow debug indicator. our game should look like this:</p>
<p><img src="Images/done_height.PNG" alt="DONE_HEIGHT"></p>
<p>Notice how the moblins yellow indicator pixel is at his top left, while link&apos;s is slightly below his head. Also, links head slightly overlaps the obstacle. This is what we expected.</p>
<h2 id="tiles">Tiles</h2>
<p>The character having depth is awesome, but we&apos;re going to want the tiles to have depth too! Unlike character however we always know the height of a tile, it&apos;s 30! Because we already know the height of the tile, all we need to change is the <code>Render</code> function in <strong>Tile.cs</strong>.</p>
<p>This is what the current tile render function looks like (I&apos;ve added comments to help readability):</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params">PointF offsetPosition</span>) </span>{
    <span class="hljs-comment">// Find the world render position of this tile</span>
    Point renderPos = <span class="hljs-keyword">new</span> Point(WorldPosition.X, WorldPosition.Y);
    <span class="hljs-comment">// Apply scale to tile offset</span>
    renderPos.X = (<span class="hljs-keyword">int</span>)(Scale * renderPos.X);
    renderPos.Y = (<span class="hljs-keyword">int</span>)(Scale * renderPos.Y);
    <span class="hljs-comment">// Move the tile into camera space</span>
    renderPos.X -= (<span class="hljs-keyword">int</span>)offsetPosition.X;
    renderPos.Y -= (<span class="hljs-keyword">int</span>)offsetPosition.Y;
    <span class="hljs-comment">// Draw the tile</span>
    TextureManager.Instance.Draw(Sprite, renderPos, Scale, Source);
}
</code></pre>
<p>After moving the tile into camera space, make a new rectangle, call it renderRect and copy Source into is, then use this new renderRect to draw instead of Source (Change last argument). You can copy one rect into another with only two arguments like so:</p>
<pre><code class="lang-cs">Rectangle renderRect = <span class="hljs-keyword">new</span> Rectangle(Source.Location, Source.Size);
</code></pre>
<p>After creating renderRect, check it&apos;s height. If renderRect.Height <strong>is not equal to</strong> 30 we will want to offset the tile render position. </p>
<p>To offset the render position, first find the <code>heightDifference</code> by subtracting 30 from renderRect.Height, i suggest storing this in a variable. Then, subtract <code>heightDifference</code> from <code>renderRect.Y</code>.</p>
<p>That&apos;s it! Tiles now have the same depth support that the character does. We will not be able to test this right now for two resons. First, we don&apos;t have any tiles that are taler than 30 pixels. </p>
<p>Second, because we draw all the tiles first, then the character on top, we would never see the character behind a tile. We&apos;re going to fix this in the next section.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./Chapter22.html" class="navigation navigation-prev " aria-label="Previous page: Depth"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./DepthBuffer.html" class="navigation navigation-next " aria-label="Next page: X Depth Buffer"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
