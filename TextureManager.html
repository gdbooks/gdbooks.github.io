<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>TextureManager | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="./InputManager.html" />
    
    
    <link rel="prev" href="./GraphicsManager.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="1.2" data-basepath="." data-revision="Sun Sep 13 2015 05:15:44 GMT-0700 (Pacific Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Chapter1.html">
            
                
                    <a href="./Chapter1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Starting Out
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="GraphicsManager.html">
            
                
                    <a href="./GraphicsManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        GraphicsManager
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1.2" data-path="TextureManager.html">
            
                
                    <a href="./TextureManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        TextureManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="InputManager.html">
            
                
                    <a href="./InputManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        InputManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="AudioManager.html">
            
                
                    <a href="./AudioManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        SoundManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Game.html">
            
                
                    <a href="./Game.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Game
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Program.html">
            
                
                    <a href="./Program.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Program
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Chapter2.html">
            
                
                    <a href="./Chapter2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Why Tiles?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Chapter3.html">
            
                
                    <a href="./Chapter3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Map Format
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Chapter6.html">
            
                
                    <a href="./Chapter6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Creating Tiles
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Practice/PracticeCh6.html">
            
                
                    <a href="./Practice/PracticeCh6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Chapter5.html">
            
                
                    <a href="./Chapter5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Map Tools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Chapter8.html">
            
                
                    <a href="./Chapter8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        The Hero
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Practice/PracticeTheHero.html">
            
                
                    <a href="./Practice/PracticeTheHero.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Chapter9.html">
            
                
                    <a href="./Chapter9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Keys To Move
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Practice/PracticeMoving.html">
            
                
                    <a href="./Practice/PracticeMoving.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="8" data-path="Chapter10.html">
            
                
                    <a href="./Chapter10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Hit The Wall
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Chapter11.html">
            
                
                    <a href="./Chapter11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Open The Door
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="cleanup.html">
            
                
                    <a href="./cleanup.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Cleaning Up
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="borders.html">
            
                
                    <a href="./borders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Screen Borders
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Chapter12.html">
            
                
                    <a href="./Chapter12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        X Jumping
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="Chapter13.html">
            
                
                    <a href="./Chapter13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        X Clouds
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="Chapter14.html">
            
                
                    <a href="./Chapter14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        X Ladders
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Chapter15.html">
            
                
                    <a href="./Chapter15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        X Simple Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="Chapter16.html">
            
                
                    <a href="./Chapter16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        X More Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="Chapter17.html">
            
                
                    <a href="./Chapter17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        X Shooting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="Chapter18.html">
            
                
                    <a href="./Chapter18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        X Getting Items
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="Chapter19.html">
            
                
                    <a href="./Chapter19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        X Moving Tiles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="Chapter20.html">
            
                
                    <a href="./Chapter20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        X Scrolling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="Chapter21.html">
            
                
                    <a href="./Chapter21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        X More Scrolling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="Chapter22.html">
            
                
                    <a href="./Chapter22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        X Depth
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="Chapter23.html">
            
                
                    <a href="./Chapter23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        X Ismetric View
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="Chapter24.html">
            
                
                    <a href="./Chapter24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        X Mouse To Move
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="Chapter25.html">
            
                
                    <a href="./Chapter25.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        X Iso Mouse
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="Chapter26.html">
            
                
                    <a href="./Chapter26.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        X Iso Scroll
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="Chapter27.html">
            
                
                    <a href="./Chapter27.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        X Rotating Hero
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="Chapter28.html">
            
                
                    <a href="./Chapter28.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        X Rotating Ground
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="Chapter29.html">
            
                
                    <a href="./Chapter29.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        X Slopes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="Chapter30.html">
            
                
                    <a href="./Chapter30.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        X Hexagons
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="Chapter7.html">
            
                
                    <a href="./Chapter7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        X More Tiles
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="texture-manager">Texture Manager</h1>
<p>In case the code repo ever goes down, this is a local backup of the <strong>TextureManager</strong> class</p>
<pre><code class="lang-cs"><span class="hljs-comment">//#define SAVE_PNG_BYTES</span>
<span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Drawing;
<span class="hljs-keyword">using</span> System.Drawing.Imaging;
<span class="hljs-keyword">using</span> OpenTK.Graphics.OpenGL;
<span class="hljs-keyword">using</span> System.Collections.Generic;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">GameFramework</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TextureManager</span> {
        <span class="hljs-comment">// TextureInstance: Provides a reference counted instance to a texture</span>
        <span class="hljs-comment">// we keep track of the hardware accelerated textureId (glHandle),</span>
        <span class="hljs-comment">// the original path of the texture, it&apos;s width and height</span>
        <span class="hljs-comment">// We also keep track of refCount, this is how many times the texture</span>
        <span class="hljs-comment">// is loaded. At the end of the application, refCount should be 0</span>
        <span class="hljs-comment">// if the refCount of a texture is 0, it is no longer in use, we</span>
        <span class="hljs-comment">// know that it&apos;s safe to recycle the texture when it&apos;s ref count</span>
        <span class="hljs-comment">// is 0</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TextureInstance</span> {
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> glHandle = -<span class="hljs-number">1</span>;
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> path = <span class="hljs-keyword">string</span>.Empty;
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> refCount = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> width = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> height = <span class="hljs-number">0</span>;
        }

        <span class="hljs-comment">// A list (vector) of all the texture instances currently available</span>
        <span class="hljs-comment">// not every texture instance has a ref count &gt; 0. Look at the </span>
        <span class="hljs-comment">// LoadTexture function for details on how this works.</span>
        <span class="hljs-keyword">private</span> List&lt;TextureInstance&gt; managedTextures = <span class="hljs-keyword">null</span>;

        <span class="hljs-comment">// Helper used to warn if any method is called without first</span>
        <span class="hljs-comment">// intilizing the manager</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> isInitialized = <span class="hljs-keyword">false</span>;

        <span class="hljs-comment">// If set to true, sprites will resize using nearest neighbor algorithm</span>
        <span class="hljs-comment">// nearest neighor = blocky. If false, the resized sprite will become</span>
        <span class="hljs-comment">// anti aliased.</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> UseNearestFiltering = <span class="hljs-keyword">false</span>;

        <span class="hljs-comment">// The ONLY instance of TextureManager. No class outside of the</span>
        <span class="hljs-comment">// manager can access this instance. This variable, the Instance getter</span>
        <span class="hljs-comment">// and private constructor make this class a singleton.</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> TextureManager instance = <span class="hljs-keyword">null</span>;

        <span class="hljs-comment">// Lazy accessor, no instance of TextureManager exists until the very</span>
        <span class="hljs-comment">// first time a user tries to access Instance. Once Instance is accessed</span>
        <span class="hljs-comment">// a TextureManager will exist until the application quits</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TextureManager Instance {
            <span class="hljs-keyword">get</span> {
                <span class="hljs-keyword">if</span> (instance == <span class="hljs-keyword">null</span>) {
                    instance = <span class="hljs-keyword">new</span> TextureManager();
                }
                <span class="hljs-keyword">return</span> instance;
            }
        }

        <span class="hljs-comment">// The constructor is private to prevent anything other than the Instance</span>
        <span class="hljs-comment">// getter from creating a new instance of TextureManager, this is what</span>
        <span class="hljs-comment">// makes this class a singleton.</span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">TextureManager</span>(<span class="hljs-params"></span>) </span>{

        }

        <span class="hljs-comment">// Utility function to log red text to the console</span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Error</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> error</span>) </span>{
            ConsoleColor old = Console.ForegroundColor;
            Console.ForegroundColor = ConsoleColor.Red;
            Console.WriteLine(error);
            Console.ForegroundColor = old;
        }

        <span class="hljs-comment">// Utility function to log yellow text to the console</span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Warning</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> error</span>) </span>{
            ConsoleColor old = Console.ForegroundColor;
            Console.ForegroundColor = ConsoleColor.Yellow;
            Console.WriteLine(error);
            Console.ForegroundColor = old;
        }

        <span class="hljs-comment">// Set up all necesary member variables of the texture manager</span>
        <span class="hljs-comment">// The argument this manager takes is ignored, we include it to</span>
        <span class="hljs-comment">// make all managers have a similar interface. Usually you only</span>
        <span class="hljs-comment">// initialize a manager at the start of the application.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Initialize</span>(<span class="hljs-params">OpenTK.GameWindow window</span>) </span>{
            <span class="hljs-keyword">if</span> (isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to double intialize texture manager!&quot;</span>);
            }
            managedTextures = <span class="hljs-keyword">new</span> List&lt;TextureInstance&gt;();
            <span class="hljs-comment">// List.Capacity = Vector.Reserve</span>
            <span class="hljs-comment">// We reserve enough room for 100 textures, if 101</span>
            <span class="hljs-comment">// textures are loaded, room will be reserved for 200</span>
            <span class="hljs-comment">// textures. This will keep doubling as vectors do</span>
            managedTextures.Capacity = <span class="hljs-number">100</span>;
            isInitialized = <span class="hljs-keyword">true</span>;
        }

        <span class="hljs-comment">// Deallocate all memory the texture manager is currently using, flip the</span>
        <span class="hljs-comment">// initialization flag back to false. After calling shutdown the texture</span>
        <span class="hljs-comment">// manager is invalid, unless Initialize is called again. Usually you only</span>
        <span class="hljs-comment">// shut down a manager at the end of the application.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Shutdown</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to shut down a non initialized texture manager!&quot;</span>);
            }
            <span class="hljs-comment">// Loop trough all loaded textures</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; managedTextures.Count; ++i) {
                <span class="hljs-comment">// We expect the texture count to be 0, if it&apos;s not then the textures</span>
                <span class="hljs-comment">// where not unloaded properly. We will delete them anyway, but the </span>
                <span class="hljs-comment">// user should really, REALLY fix their code.</span>
                <span class="hljs-keyword">if</span> (managedTextures[i].refCount != <span class="hljs-number">0</span>) {
                    Warning(<span class="hljs-string">&quot;Texture reference is &gt; 0: &quot;</span> + managedTextures[i].path);
                }
                <span class="hljs-comment">// Delete the texture from graphics memory</span>
                GL.DeleteTexture(managedTextures[i].glHandle);
                <span class="hljs-comment">// This isn&apos;t needed, but let&apos;s set the textures element in the array</span>
                <span class="hljs-comment">// to null, to give GC a hint that it is to be collected.</span>
                managedTextures[i] = <span class="hljs-keyword">null</span>;
            }
            <span class="hljs-comment">// .Clear and = null are not both needed. Usually = null is enough. But we</span>
            <span class="hljs-comment">// want to make sure that GC gets the hint, so we agressivley clear the list</span>
            managedTextures.Clear();
            managedTextures = <span class="hljs-keyword">null</span>;
            isInitialized = <span class="hljs-keyword">false</span>;
        }

        <span class="hljs-comment">// Helper function to determine if a given texture is a power of two or not</span>
        <span class="hljs-comment">// Graphics cards work a LOT faster when tehy have Power of Two (POT) textures</span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">IsPowerOfTwo</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> x</span>) </span>{
            <span class="hljs-comment">// If X was an unsigned long (or int), we could do this:</span>
            <span class="hljs-comment">// return (x &amp; (x - 1)) == 0;</span>
            <span class="hljs-comment">// ^ would be a lot faster. But our handle is an integer, so use a general</span>
            <span class="hljs-comment">// purpose method of figuring this out. 0 will be a POT.</span>
            <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">while</span> (x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
                    x &gt;&gt;= <span class="hljs-number">1</span>;
                }
            }
            <span class="hljs-keyword">return</span> x == <span class="hljs-number">1</span>;
        }

        <span class="hljs-comment">// Given a file name, this function will load the texture into system memory, then</span>
        <span class="hljs-comment">// upload it to GPU memory, and let the system memory become eligable for garbage collection</span>
        <span class="hljs-comment">// We really only need a reference to the texture on the GPU, as everything we do is going to</span>
        <span class="hljs-comment">// be hardware accelerated (happen on the GPU). The function will return a handle to the GPU</span>
        <span class="hljs-comment">// instance of the texture, as well as the width and height f the texutre</span>
        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">LoadGLTexture</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> filename, <span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">out</span> <span class="hljs-keyword">int</span> height, <span class="hljs-keyword">bool</span> nearest</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(filename)) {
                Error(<span class="hljs-string">&quot;Load texture file path was null&quot;</span>);
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentException(filename);
            }

            <span class="hljs-comment">// Generate a handle on the GPU</span>
            <span class="hljs-keyword">int</span> id = GL.GenTexture();
            <span class="hljs-comment">// Bind the handle to the be the active texture.</span>
            GL.BindTexture(TextureTarget.Texture2D, id);

            <span class="hljs-comment">// Ming &amp; Mag filters are needed to figure out how to interpolate scaling. If you don&apos;t </span>
            <span class="hljs-comment">// provide them the GPU will not draw your texture. Trilinear is the nicest looking,</span>
            <span class="hljs-comment">// but most expensive. Linear is kind of standard.</span>
            <span class="hljs-keyword">if</span> (nearest) {
                GL.TexParameter(TextureTarget.Texture2D, TextureParameterName.TextureMinFilter, (<span class="hljs-keyword">int</span>)TextureMinFilter.Nearest);
                GL.TexParameter(TextureTarget.Texture2D, TextureParameterName.TextureMagFilter, (<span class="hljs-keyword">int</span>)TextureMagFilter.Nearest);
            }
            <span class="hljs-keyword">else</span> {
                GL.TexParameter(TextureTarget.Texture2D, TextureParameterName.TextureMinFilter, (<span class="hljs-keyword">int</span>)TextureMinFilter.Linear);
                GL.TexParameter(TextureTarget.Texture2D, TextureParameterName.TextureMagFilter, (<span class="hljs-keyword">int</span>)TextureMagFilter.Linear);
            }
            <span class="hljs-comment">// Allocate system memory for the image</span>
            Bitmap bmp = <span class="hljs-keyword">new</span> Bitmap(filename);
            <span class="hljs-comment">// Load the image into system memory</span>
            BitmapData bmp_data = bmp.LockBits(<span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, bmp.Width, bmp.Height), ImageLockMode.ReadOnly, System.Drawing.Imaging.PixelFormat.Format32bppArgb);

            <span class="hljs-comment">// If the texture is non POT, or bigger than 2048 warn the user so they can fix</span>
            <span class="hljs-comment">// the texutre during development</span>
            <span class="hljs-keyword">if</span> (!IsPowerOfTwo(bmp.Width)) {
                Warning(<span class="hljs-string">&quot;Texture width non power of two: &quot;</span> + filename);
            }

            <span class="hljs-keyword">if</span> (!IsPowerOfTwo(bmp.Height)) {
                Warning(<span class="hljs-string">&quot;Texture height  non power of two: &quot;</span> + filename);
            }

            <span class="hljs-keyword">if</span> (bmp.Width &gt; <span class="hljs-number">2048</span>) {
                Warning(<span class="hljs-string">&quot;Texture width &gt; 2048: &quot;</span> + filename);
            }

            <span class="hljs-keyword">if</span> (bmp.Height &gt; <span class="hljs-number">2048</span>) {
                Warning(<span class="hljs-string">&quot;Texture height &gt; 2048: &quot;</span> + filename);
            }

            <span class="hljs-comment">// Upload the image data to the GPU</span>
            GL.TexImage2D(TextureTarget.Texture2D, <span class="hljs-number">0</span>, PixelInternalFormat.Rgba, bmp_data.Width, bmp_data.Height, <span class="hljs-number">0</span>, OpenTK.Graphics.OpenGL.PixelFormat.Bgra, PixelType.UnsignedByte, bmp_data.Scan0);

<span class="hljs-preprocessor">#<span class="hljs-keyword">if</span> SAVE_PNG_BYTES</span>
            <span class="hljs-keyword">byte</span>[] byteArray = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[bmp_data.Width * bmp_data.Height * <span class="hljs-number">4</span>];
            System.Runtime.InteropServices.Marshal.Copy(bmp_data.Scan0, byteArray, <span class="hljs-number">0</span>, byteArray.Length);

            System.Text.StringBuilder sb = <span class="hljs-keyword">new</span> System.Text.StringBuilder();
            sb.Append(<span class="hljs-string">&quot;{\n&quot;</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; byteArray.Length; ++i) {
                sb.Append(<span class="hljs-string">&quot;0x&quot;</span>);
                sb.AppendFormat(<span class="hljs-string">&quot;{0:x2}&quot;</span>, byteArray[i]);
                <span class="hljs-keyword">if</span> (i != byteArray.Length - <span class="hljs-number">1</span>) {
                    sb.Append(<span class="hljs-string">&quot;, &quot;</span>);
                }
                <span class="hljs-keyword">if</span> (i != <span class="hljs-number">0</span> &amp;&amp; i%<span class="hljs-number">16</span> == <span class="hljs-number">0</span>) {
                    sb.Append(<span class="hljs-string">&quot;\n&quot;</span>);
                }
            }
            sb.Append(<span class="hljs-string">&quot;\n};&quot;</span>);

            <span class="hljs-keyword">string</span> directory = System.IO.Path.GetDirectoryName(filename);
            <span class="hljs-keyword">string</span> file = System.IO.Path.GetFileNameWithoutExtension(filename);

            System.IO.File.WriteAllText(directory + <span class="hljs-string">&quot;/&quot;</span> + file + <span class="hljs-string">&quot;.array&quot;</span>, sb.ToString());
<span class="hljs-preprocessor">#<span class="hljs-keyword">endif</span></span>

            <span class="hljs-comment">// Mark system memory eligable for GC</span>
            bmp.UnlockBits(bmp_data);

            <span class="hljs-comment">// Return the textures width, height and GPU ID</span>
            width = bmp.Width;
            height = bmp.Height;
            <span class="hljs-keyword">return</span> id;
        }

        <span class="hljs-comment">// Public facing interface for loading a texture. Given a texture path it will return a handle</span>
        <span class="hljs-comment">// (index into managedTextures vector) which can later be used to draw the texture.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">LoadTexture</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> texturePath</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to load texture without intializing texture manager!&quot;</span>);
            }

            <span class="hljs-comment">// First, check if the texture is already being managed. If it is, increase ref count and</span>
            <span class="hljs-comment">// return the textures index.</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; managedTextures.Count; ++i) {
                <span class="hljs-keyword">if</span> (managedTextures[i].path == texturePath) {
                    managedTextures[i].refCount += <span class="hljs-number">1</span>;
                    <span class="hljs-keyword">return</span> i;
                }
            }

            <span class="hljs-comment">// If the texture was not being tracked, go trough the list and look for an open space, if an</span>
            <span class="hljs-comment">// open space is found, unload it&apos;s texture from GPU memory, and load our new texture, override</span>
            <span class="hljs-comment">// the reference count, path, width, height and texture handle with new values</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; managedTextures.Count; ++i) {
                <span class="hljs-keyword">if</span> (managedTextures[i].refCount &lt;= <span class="hljs-number">0</span>) {
                    GL.DeleteTexture(managedTextures[i].glHandle);
                    managedTextures[i].glHandle = LoadGLTexture(texturePath, <span class="hljs-keyword">out</span> managedTextures[i].width, <span class="hljs-keyword">out</span> managedTextures[i].height, UseNearestFiltering);
                    managedTextures[i].refCount = <span class="hljs-number">1</span>;
                    managedTextures[i].path = texturePath;
                    <span class="hljs-keyword">return</span> i;
                }
            }

            <span class="hljs-comment">// Finally we get here if the texture we are trying to load is not an already managed texture</span>
            <span class="hljs-comment">// and we have no open spots for new textures to be managed. Here we just create a new texture</span>
            <span class="hljs-comment">// and add it to the managed textures vector</span>
            TextureInstance newTexture = <span class="hljs-keyword">new</span> TextureInstance();
            newTexture.refCount = <span class="hljs-number">1</span>;
            newTexture.glHandle = LoadGLTexture(texturePath, <span class="hljs-keyword">out</span> newTexture.width, <span class="hljs-keyword">out</span> newTexture.height, UseNearestFiltering);
            newTexture.path = texturePath;
            managedTextures.Add(newTexture);
            <span class="hljs-keyword">return</span> managedTextures.Count - <span class="hljs-number">1</span>;
        }

        <span class="hljs-comment">// This function decreases the textures reference count. It does not de-allocate the texture</span>
        <span class="hljs-comment">// memory on the GPU. The reason for this is that there is a decent chance that some textures</span>
        <span class="hljs-comment">// will stay around between scene loads. This way if a texture&apos;s reference count reaches 0,</span>
        <span class="hljs-comment">// and it hasn&apos;t been overwritten yet, if we load it again we get that load for free.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">UnloadTexture</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to unload texture without intializing texture manager!&quot;</span>);
            }
            managedTextures[textureId].refCount -= <span class="hljs-number">1</span>;

            <span class="hljs-comment">// If we go below -1, no problem. But the system is intended to go only to 0, so lets</span>
            <span class="hljs-comment">// warn the user that they cleaned up wrong</span>
            <span class="hljs-keyword">if</span> (managedTextures[textureId].refCount &lt; <span class="hljs-number">0</span>) {
                Error(<span class="hljs-string">&quot;Ref count of texture is less than 0: &quot;</span> + managedTextures[textureId].path);
            }
        }

        <span class="hljs-comment">// Simple getter to access the width of a texture</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTextureWidth</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to access texture width without intializing texture manager!&quot;</span>);
            }
            <span class="hljs-keyword">return</span> managedTextures[textureId].width;
        }

        <span class="hljs-comment">// Simple getter to access the height of a texture</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">GetTextureHeight</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to access texture height without intializing texture manager!&quot;</span>);
            }
            <span class="hljs-keyword">return</span> managedTextures[textureId].height;
        }

        <span class="hljs-comment">// Simple getter to access the size of a texture</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> Size <span class="hljs-title">GetTextureSize</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to access texture size without intializing texture manager!&quot;</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Size(managedTextures[textureId].width, managedTextures[textureId].height);
        }

        <span class="hljs-comment">// Given a texture id, draw it at the specified screen position. This will draw the</span>
        <span class="hljs-comment">// entire texture at that position, nothing gets cut off</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to draw texture without intializing texture manager!&quot;</span>);
            }
            <span class="hljs-comment">// Let the graphics manager know that we are drawing on top of everything else</span>
            GraphicsManager.Instance.IncreaseDepth();
            <span class="hljs-comment">// Save the current transform matrix</span>
            GL.PushMatrix();

            <span class="hljs-comment">// Build out the rectangle we will be drawing</span>
            <span class="hljs-keyword">float</span> left = <span class="hljs-number">0.0</span>f;
            <span class="hljs-keyword">float</span> top = <span class="hljs-number">0.0</span>f;
            <span class="hljs-keyword">float</span> right = left + managedTextures[textureId].width;
            <span class="hljs-keyword">float</span> bottom = top + managedTextures[textureId].height;

            <span class="hljs-comment">// Because blending is enabled, we want to blend the color of the texture with</span>
            <span class="hljs-comment">// just straight white. That way we get the correct color back</span>
            GL.Color3(<span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f);

            <span class="hljs-comment">// Bind the texture we want to draw to be active</span>
            GL.BindTexture(TextureTarget.Texture2D, managedTextures[textureId].glHandle);

            <span class="hljs-comment">// Offset to the correct position to draw at</span>
            GL.Translate(screenPosition.X, screenPosition.Y, GraphicsManager.Instance.Depth);

            <span class="hljs-comment">// Draw a quad</span>
            GL.Begin(PrimitiveType.Quads);
            GL.TexCoord2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// What part of the texture to draw</span>
            GL.Vertex3(left, bottom, <span class="hljs-number">0.0</span>f); <span class="hljs-comment">// Where on screen to draw it</span>
            GL.TexCoord2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            GL.Vertex3(right, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
            GL.Vertex3(right, top, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            GL.Vertex3(left, top, <span class="hljs-number">0.0</span>f);
            GL.End();

            <span class="hljs-comment">// Restore the saved transform matrix</span>
            GL.PopMatrix();
            <span class="hljs-comment">// Unbind any active textures</span>
            GL.BindTexture(TextureTarget.Texture2D, <span class="hljs-number">0</span>);
        }

        <span class="hljs-comment">// Given a texture id, draw it at the specified screen position and scale it.</span>
        <span class="hljs-comment">// This will draw the entire texture at that position, nothing gets cut off,</span>
        <span class="hljs-comment">// but it is possible to scale the image down or up</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, <span class="hljs-keyword">float</span> scale</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to draw texture without intializing texture manager!&quot;</span>);
            }
            Draw(textureId, screenPosition, <span class="hljs-keyword">new</span> PointF(scale, scale));
        }

        <span class="hljs-comment">// Given a texture id, draw it at the specified screen position and scale it.</span>
        <span class="hljs-comment">// This will draw the entire texture at that position, nothing gets cut off,</span>
        <span class="hljs-comment">// but it is possible to scale the image down or up</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, PointF scale</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to draw texture without intializing texture manager!&quot;</span>);
            }
            GraphicsManager.Instance.IncreaseDepth();
            GL.PushMatrix();

            <span class="hljs-keyword">float</span> left = <span class="hljs-number">0.0</span>f;
            <span class="hljs-keyword">float</span> top = <span class="hljs-number">0.0</span>f;
            <span class="hljs-keyword">float</span> right = left + managedTextures[textureId].width;
            <span class="hljs-keyword">float</span> bottom = top + managedTextures[textureId].height;

            GL.Color3(<span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f);
            GL.BindTexture(TextureTarget.Texture2D, managedTextures[textureId].glHandle);
            GL.Translate(screenPosition.X, screenPosition.Y, GraphicsManager.Instance.Depth);
            GL.Scale(scale.X, scale.Y, <span class="hljs-number">1.0</span>f);

            GL.Begin(PrimitiveType.Quads);
            GL.TexCoord2(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
            GL.Vertex3(left, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            GL.Vertex3(right, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>);
            GL.Vertex3(right, top, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
            GL.Vertex3(left, top, <span class="hljs-number">0.0</span>f);
            GL.End();

            GL.PopMatrix();
            GL.BindTexture(TextureTarget.Texture2D, <span class="hljs-number">0</span>);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, <span class="hljs-keyword">float</span> scale, Rectangle sourceSection</span>) </span>{
            Draw(textureId, screenPosition, <span class="hljs-keyword">new</span> PointF(scale, scale), sourceSection);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, PointF scale, Rectangle sourceSection</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to draw texture without intializing texture manager!&quot;</span>);
            }
            GraphicsManager.Instance.IncreaseDepth();
            GL.PushMatrix();

            <span class="hljs-keyword">float</span> left = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">float</span> top = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">float</span> right = left + sourceSection.Width;
            <span class="hljs-keyword">float</span> bottom = top + sourceSection.Height;

            <span class="hljs-keyword">float</span> wRecip = <span class="hljs-number">1.0</span>f / ((<span class="hljs-keyword">float</span>)managedTextures[textureId].width);
            <span class="hljs-keyword">float</span> hRecip = <span class="hljs-number">1.0</span>f / ((<span class="hljs-keyword">float</span>)managedTextures[textureId].height);

            <span class="hljs-keyword">float</span> uvLeft = ((<span class="hljs-keyword">float</span>)sourceSection.X) * wRecip;
            <span class="hljs-keyword">float</span> uvTop = ((<span class="hljs-keyword">float</span>)sourceSection.Y) * hRecip;
            <span class="hljs-keyword">float</span> uvRight = uvLeft + ((<span class="hljs-keyword">float</span>)sourceSection.Width) * wRecip;
            <span class="hljs-keyword">float</span> uvBottom = uvTop + ((<span class="hljs-keyword">float</span>)sourceSection.Height) * hRecip;

            GL.Color3(<span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f);
            GL.BindTexture(TextureTarget.Texture2D, managedTextures[textureId].glHandle);
            GL.Translate(screenPosition.X, screenPosition.Y, GraphicsManager.Instance.Depth);
            GL.Scale(scale.X, scale.Y, <span class="hljs-number">1.0</span>f);

            GL.Begin(PrimitiveType.Quads);
            GL.TexCoord2(uvLeft, uvBottom);
            GL.Vertex3(left, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvRight, uvBottom);
            GL.Vertex3(right, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvRight, uvTop);
            GL.Vertex3(right, top, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvLeft, uvTop);
            GL.Vertex3(left, top, <span class="hljs-number">0.0</span>f);
            GL.End();

            GL.PopMatrix();
            GL.BindTexture(TextureTarget.Texture2D, <span class="hljs-number">0</span>);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it.</span>
        <span class="hljs-comment">// The resulting image can then be rotated about it&apos;s center by any angle.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, <span class="hljs-keyword">float</span> scale, Rectangle sourceSection, <span class="hljs-keyword">float</span> rotation</span>) </span>{
            Point rotationCenter = <span class="hljs-keyword">new</span> Point(sourceSection.Width / <span class="hljs-number">2</span>, sourceSection.Height / <span class="hljs-number">2</span>);
            Draw(textureId, screenPosition, <span class="hljs-keyword">new</span> PointF(scale, scale), sourceSection, rotationCenter, rotation);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it.</span>
        <span class="hljs-comment">// The resulting image can then be rotated about it&apos;s center by any angle.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, PointF scale, Rectangle sourceSection, <span class="hljs-keyword">float</span> rotation</span>) </span>{
            Point rotationCenter = <span class="hljs-keyword">new</span> Point(sourceSection.Width / <span class="hljs-number">2</span>, sourceSection.Height / <span class="hljs-number">2</span>);
            Draw(textureId, screenPosition, scale, sourceSection, rotationCenter, rotation);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it.</span>
        <span class="hljs-comment">// The resulting image can then be rotated about a specified point by any angle.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, <span class="hljs-keyword">float</span> scale, Rectangle sourceSection, Point rotationCenter, <span class="hljs-keyword">float</span> rotation = <span class="hljs-number">0.0</span>f</span>) </span>{
            Draw(textureId, screenPosition, <span class="hljs-keyword">new</span> PointF(scale, scale), sourceSection, rotationCenter, rotation);
        }

        <span class="hljs-comment">// Given a texture id, draw a sub-section of that texture at the specified screen position </span>
        <span class="hljs-comment">// and possibly scale it. This will not draw the whole texture, just a specific rectangle form it.</span>
        <span class="hljs-comment">// The resulting image can then be rotated about a specified point by any angle.</span>
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Draw</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> textureId, Point screenPosition, PointF scale, Rectangle sourceSection, Point rotationCenter, <span class="hljs-keyword">float</span> rotation = <span class="hljs-number">0.0</span>f</span>) </span>{
            <span class="hljs-keyword">if</span> (!isInitialized) {
                Error(<span class="hljs-string">&quot;Trying to draw texture without intializing texture manager!&quot;</span>);
            }
            GraphicsManager.Instance.IncreaseDepth();
            GL.PushMatrix();

            <span class="hljs-keyword">float</span> left = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">float</span> top = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">float</span> right = left + sourceSection.Width;
            <span class="hljs-keyword">float</span> bottom = top + sourceSection.Height;

            <span class="hljs-keyword">float</span> wRecip = <span class="hljs-number">1.0</span>f / ((<span class="hljs-keyword">float</span>)managedTextures[textureId].width);
            <span class="hljs-keyword">float</span> hRecip = <span class="hljs-number">1.0</span>f / ((<span class="hljs-keyword">float</span>)managedTextures[textureId].height);

            <span class="hljs-keyword">float</span> uvLeft = ((<span class="hljs-keyword">float</span>)sourceSection.X) * wRecip;
            <span class="hljs-keyword">float</span> uvTop = ((<span class="hljs-keyword">float</span>)sourceSection.Y) * hRecip;
            <span class="hljs-keyword">float</span> uvRight = uvLeft + ((<span class="hljs-keyword">float</span>)sourceSection.Width) * wRecip;
            <span class="hljs-keyword">float</span> uvBottom = uvTop + ((<span class="hljs-keyword">float</span>)sourceSection.Height) * hRecip;

            GL.Color3(<span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">1.0</span>f);
            GL.BindTexture(TextureTarget.Texture2D, managedTextures[textureId].glHandle);

            GL.Translate(screenPosition.X, screenPosition.Y, GraphicsManager.Instance.Depth);

            GL.Translate(((<span class="hljs-keyword">float</span>)rotationCenter.X) * scale.X, ((<span class="hljs-keyword">float</span>)rotationCenter.Y) * scale.Y, <span class="hljs-number">0.0</span>f);
            GL.Rotate(rotation, <span class="hljs-number">0.0</span>f, <span class="hljs-number">0.0</span>f, <span class="hljs-number">1.0</span>f);
            GL.Translate(-((<span class="hljs-keyword">float</span>)rotationCenter.X) * scale.X, -((<span class="hljs-keyword">float</span>)rotationCenter.Y) * scale.Y, <span class="hljs-number">0.0</span>f);

            GL.Scale(scale.X, scale.Y, <span class="hljs-number">1.0</span>f);

            GL.Begin(PrimitiveType.Quads);
            GL.TexCoord2(uvLeft, uvBottom);
            GL.Vertex3(left, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvRight, uvBottom);
            GL.Vertex3(right, bottom, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvRight, uvTop);
            GL.Vertex3(right, top, <span class="hljs-number">0.0</span>f);
            GL.TexCoord2(uvLeft, uvTop);
            GL.Vertex3(left, top, <span class="hljs-number">0.0</span>f);
            GL.End();

            GL.PopMatrix();
            GL.BindTexture(TextureTarget.Texture2D, <span class="hljs-number">0</span>);
        }
    }
}
</code></pre>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./GraphicsManager.html" class="navigation navigation-prev " aria-label="Previous page: GraphicsManager"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./InputManager.html" class="navigation navigation-next " aria-label="Next page: InputManager"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
