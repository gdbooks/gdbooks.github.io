<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Hit The Wall | Introduction</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.3.0">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
    

        
    
    
    <link rel="next" href="./Chapter11.html" />
    
    
    <link rel="prev" href="./Practice/PracticeMoving.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="8" data-basepath="." data-revision="Thu Sep 17 2015 02:11:36 GMT-0700 (Pacific Daylight Time)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="Chapter1.html">
            
                
                    <a href="./Chapter1.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Starting Out
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" data-path="GraphicsManager.html">
            
                
                    <a href="./GraphicsManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                        GraphicsManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="TextureManager.html">
            
                
                    <a href="./TextureManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.</b>
                        
                        TextureManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="InputManager.html">
            
                
                    <a href="./InputManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        InputManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="AudioManager.html">
            
                
                    <a href="./AudioManager.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        SoundManager
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="Game.html">
            
                
                    <a href="./Game.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Game
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Program.html">
            
                
                    <a href="./Program.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.6.</b>
                        
                        Program
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" data-path="Chapter2.html">
            
                
                    <a href="./Chapter2.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Why Tiles?
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="Chapter3.html">
            
                
                    <a href="./Chapter3.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Map Format
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="Chapter6.html">
            
                
                    <a href="./Chapter6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Creating Tiles
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1" data-path="Practice/PracticeCh6.html">
            
                
                    <a href="./Practice/PracticeCh6.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="5" data-path="Chapter5.html">
            
                
                    <a href="./Chapter5.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Map Tools
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="Chapter8.html">
            
                
                    <a href="./Chapter8.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        The Hero
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="6.1" data-path="Practice/PracticeTheHero.html">
            
                
                    <a href="./Practice/PracticeTheHero.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="7" data-path="Chapter9.html">
            
                
                    <a href="./Chapter9.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        Keys To Move
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="7.1" data-path="Practice/PracticeMoving.html">
            
                
                    <a href="./Practice/PracticeMoving.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.1.</b>
                        
                        On Your Own
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="8" data-path="Chapter10.html">
            
                
                    <a href="./Chapter10.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Hit The Wall
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="Chapter11.html">
            
                
                    <a href="./Chapter11.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Open The Door
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="9.1" data-path="cleanup.html">
            
                
                    <a href="./cleanup.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.1.</b>
                        
                        Cleaning Up
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9.2" data-path="borders.html">
            
                
                    <a href="./borders.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.2.</b>
                        
                        Screen Borders
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="10" data-path="Chapter12.html">
            
                
                    <a href="./Chapter12.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Jumping
                    </a>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="10.1" data-path="jumpconfig.html">
            
                
                    <a href="./jumpconfig.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.1.</b>
                        
                        Configurable Jumping
                    </a>
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="11" data-path="Chapter13.html">
            
                
                    <a href="./Chapter13.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Clouds
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="Chapter14.html">
            
                
                    <a href="./Chapter14.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        X Ladders
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="Chapter15.html">
            
                
                    <a href="./Chapter15.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        X Simple Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="Chapter16.html">
            
                
                    <a href="./Chapter16.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        X More Enemy
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="Chapter17.html">
            
                
                    <a href="./Chapter17.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        X Shooting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="Chapter18.html">
            
                
                    <a href="./Chapter18.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        X Getting Items
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="Chapter19.html">
            
                
                    <a href="./Chapter19.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        X Moving Tiles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="Chapter20.html">
            
                
                    <a href="./Chapter20.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        X Scrolling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="Chapter21.html">
            
                
                    <a href="./Chapter21.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        X More Scrolling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="Chapter22.html">
            
                
                    <a href="./Chapter22.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        X Depth
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="Chapter23.html">
            
                
                    <a href="./Chapter23.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        X Ismetric View
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="Chapter24.html">
            
                
                    <a href="./Chapter24.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        X Mouse To Move
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="Chapter25.html">
            
                
                    <a href="./Chapter25.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        X Iso Mouse
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="Chapter26.html">
            
                
                    <a href="./Chapter26.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        X Iso Scroll
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="Chapter27.html">
            
                
                    <a href="./Chapter27.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        X Rotating Hero
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="Chapter28.html">
            
                
                    <a href="./Chapter28.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        X Rotating Ground
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="Chapter29.html">
            
                
                    <a href="./Chapter29.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        X Slopes
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="Chapter30.html">
            
                
                    <a href="./Chapter30.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        X Hexagons
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="Chapter7.html">
            
                
                    <a href="./Chapter7.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        X More Tiles
                    </a>
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >Introduction</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="hit-the-wall">Hit The Wall</h1>
<p>Having a hero who can walk is fun, but it would be even more fun if the hero could hit the brick wall... With his face! Handling collisions with walls is not that hard. We&apos;ve done this in <strong>WinFormGames</strong> before. Given this situation:</p>
<p><img src="Images/col1.PNG" alt="COLLISION1"></p>
<p>We first want to find the rectangle for both link (outlined blue) and the obstacle (outlined green):</p>
<p><img src="Images/col2.png" alt="COLLISION2"></p>
<p>Using these two rectangles we want to see if they intersect. To do this we look for an intersection rectangle (outlined in red):</p>
<p><img src="Images/col3.png" alt="COLLISION3"></p>
<p>If the intersection(red) rectangle has an area greater than 0 (That is, if a collision has happened) we must resolve the collision. We do this by moving the character to the left, right up or down by the width or height of the intersection.</p>
<h3 id="new-project">New Project</h3>
<p>Let&apos;s make a new project, call it <strong>HitTheWall</strong> and get this project up to par with the <strong>MovingPractice</strong> section of the writeup. We&apos;re going to work from here.</p>
<h3 id="intersection">Intersection</h3>
<p>From the above description it becomes clear that we need to be able to get an intersection rectangle between two rectangles. We&apos;re going to add this ability to a common helper class. If this method is looking alien try to draw out all of the intersection cases on paper and follow it trough for each.</p>
<p>Let&apos;s make a new file, call it <strong>Intersections.cs</strong> and add the follwoing class to it:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">using</span> System.Drawing;

<span class="hljs-keyword">namespace</span> <span class="hljs-title">HitTheWall</span> {
    <span class="hljs-keyword">class</span> <span class="hljs-title">Intersections</span> {
        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Rectangle <span class="hljs-title">Rect</span>(<span class="hljs-params">Rectangle a, Rectangle b</span>) </span>{
            Rectangle result = <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);

            <span class="hljs-comment">// Do they even intersect?</span>
            <span class="hljs-keyword">if</span> (a.Left &lt; b.Right &amp;&amp; a.Right &gt; b.Left &amp;&amp; a.Top &lt; b.Bottom &amp;&amp; a.Bottom &gt; b.Top) {
                <span class="hljs-comment">// They intersect, let&apos;s get the intersection</span>

                result.X = System.Math.Max(a.Left, b.Left);
                result.Y = System.Math.Max(a.Top, b.Top);

                <span class="hljs-keyword">int</span> right = System.Math.Min(a.Right, b.Right);
                <span class="hljs-keyword">int</span> bottom = System.Math.Min(a.Bottom, b.Bottom);

                <span class="hljs-comment">// Originally i assumed there might be an error in this function, because what if</span>
                <span class="hljs-comment">// right is less than result.X? After reviewing the above math on paper i realize</span>
                <span class="hljs-comment">// that these concerns where ungrounded, and that right will ALWAYS be greater!</span>

                result.Width = right - result.X;
                result.Height = bottom - result.Y;
            }

            <span class="hljs-keyword">return</span> result;
        }

    }
}
</code></pre>
<p>If you end up drawing and labeling these, remember X / Y is the same as Top / Left. But Width / Height are different from Bottom / Right:</p>
<p><img src="Images/labels.png" alt="labeles"></p>
<h3 id="character-refactor">Character Refactor</h3>
<p>We&apos;re going to need to know some information about the character that we don&apos;t already know. Nameley we will need to know the center point of the character, and the bounding rectangle of the character. Remember, these can be different for every frame. </p>
<p>We&apos;re going to add some getters for the missing information, remember this is going in the <code>Character</code> class, not <em>PlayerCharacter</em>. You should have enough information to figure these attributes out. Implement these getters:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">public</span> PointF Center {
    <span class="hljs-keyword">get</span> {
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span></span>
    }
}

<span class="hljs-keyword">public</span> Rectangle Rect {
    <span class="hljs-keyword">get</span> {
        <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span></span>
    }
}
</code></pre>
<p>If you have any questions about the implementation of these, don&apos;t hesitate to ask. While we&apos;re in the <code>Character</code> let&apos;s update the <strong>Render</strong> function with some debug code.</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span>) </span>{
    GraphicsManager.Instance.DrawRect(Rect, Color.Red);
    TextureManager.Instance.Draw(Sprite, <span class="hljs-keyword">new</span> Point((<span class="hljs-keyword">int</span>)Position.X,(<span class="hljs-keyword">int</span>)Position.Y), <span class="hljs-number">1.0</span>f, SpriteSource[currentSprite][currentFrame]);
    Rectangle center = <span class="hljs-keyword">new</span> Rectangle((<span class="hljs-keyword">int</span>)Center.X - <span class="hljs-number">5</span>, (<span class="hljs-keyword">int</span>)Center.Y - <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
    GraphicsManager.Instance.DrawRect(center, Color.Yellow);
}
</code></pre>
<p>Adding the debug code should draw link with a red square the size of his bounding box behind him and with a yellow box at his sprites center:</p>
<p><img src="Images/wallscreen1.PNG" alt="SCREEN"></p>
<p>Let&apos;s also change the characters position from a getter to a variable. Find this line in <strong>Character.cs</strong></p>
<pre><code class="lang-cs"><span class="hljs-keyword">public</span> PointF Position { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }
</code></pre>
<p>And change it to</p>
<pre><code class="lang-cs"><span class="hljs-keyword">public</span> PointF Position = <span class="hljs-keyword">new</span> PointF(<span class="hljs-number">0.0</span>f, <span class="hljs-number">0.0</span>f);
</code></pre>
<p>Now that Position is a variable and not a getter we can modify the X and Y properties of the value directly. Open up <strong>PlayerCharacter.cs</strong> </p>
<p>Find and remove these two lines</p>
<pre><code class="lang-cs">PointF positionCpy = Position;
<span class="hljs-comment">// ...</span>
Position = positionCpy;
</code></pre>
<p>And replace every instance of <code>positionCpy</code> with <code>Position</code></p>
<p>We&apos;re going to change one last thing about the <code>Character</code> class. Back in <strong>Character.cs</strong> add the following code to the class</p>
<pre><code class="lang-cs"><span class="hljs-keyword">public</span> PointF[] Corners {
    <span class="hljs-keyword">get</span> {
        <span class="hljs-keyword">float</span> w = SpriteSource[currentSprite][currentFrame].Width;
        <span class="hljs-keyword">float</span> h = SpriteSource[currentSprite][currentFrame].Height;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PointF[] {
            <span class="hljs-keyword">new</span> PointF(Position.X, Position.Y),             <span class="hljs-comment">// Top Left</span>
            <span class="hljs-keyword">new</span> PointF(Position.X + w, Position.Y),         <span class="hljs-comment">// Top Right</span>
            <span class="hljs-keyword">new</span> PointF(Position.X, Position.Y + h),         <span class="hljs-comment">// Bottom Left</span>
            <span class="hljs-keyword">new</span> PointF(Position.X + w, Position.Y + h)      <span class="hljs-comment">// Bottom Right</span>
        };
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> CORNER_TOP_LEFT = <span class="hljs-number">0</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> CORNER_TOP_RIGHT = <span class="hljs-number">1</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> CORNER_BOTTOM_LEFT = <span class="hljs-number">2</span>;
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">int</span> CORNER_BOTTOM_RIGHT = <span class="hljs-number">3</span>;
</code></pre>
<p>The <code>Corners</code> accessor will return an array of 4 points. Each point is one of the corners of the player sprite. After that we have some named constants. These constants will allow us to access the <code>Corners</code> array by name isntead of having to remember hard coded numbers. Like so:</p>
<pre><code class="lang-cs">Rectangle topRight = heroChar.Corners[<span class="hljs-number">2</span>]; <span class="hljs-comment">// Flaky, we don&apos;t want to do this</span>
Rectangle topLeft = heroChar.Corners[Hero.CORNER_TOP_LEFT]; <span class="hljs-comment">// Sexy, ALWAYS DO THIS!</span>
</code></pre>
<p>Let&apos;s visualize what this looks like. Change the <code>Render</code> function in <strong>Character.cs</strong> to:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span>) </span>{
    GraphicsManager.Instance.DrawRect(Rect, Color.Red);
    TextureManager.Instance.Draw(Sprite, <span class="hljs-keyword">new</span> Point((<span class="hljs-keyword">int</span>)Position.X, (<span class="hljs-keyword">int</span>)Position.Y), <span class="hljs-number">1.0</span>f, SpriteSource[currentSprite][currentFrame]);
    Rectangle center = <span class="hljs-keyword">new</span> Rectangle((<span class="hljs-keyword">int</span>)Center.X - <span class="hljs-number">5</span>, (<span class="hljs-keyword">int</span>)Center.Y - <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
    GraphicsManager.Instance.DrawRect(center, Color.Yellow);
    <span class="hljs-keyword">foreach</span>(PointF corner <span class="hljs-keyword">in</span> Corners) {
        Rectangle rect = <span class="hljs-keyword">new</span> Rectangle((<span class="hljs-keyword">int</span>)corner.X - <span class="hljs-number">5</span>, (<span class="hljs-keyword">int</span>)corner.Y - <span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
        GraphicsManager.Instance.DrawRect(rect, Color.Green);
    }
}
</code></pre>
<p>Your code at this point should look like this:</p>
<p><img src="Images/wallscreen2.PNG" alt="SCREEN"></p>
<h3 id="resolving-collisions">Resolving collisions</h3>
<p>Nine times out of ten resolving collisions is going to go in the same function that handles input. (What&apos;s the case when this isn&apos;t how it happens? When solving continous integration systems in a Physics engine). In order to resolve collisions we need to know a few things. </p>
<ul>
<li>Move the character</li>
<li>Get a list of obstacles the character can hit.</li>
<li>Check if character has hit obstacle<ul>
<li>If so, undo the move action (clamp to obstacle)</li>
</ul>
</li>
</ul>
<p>Pretty simple. We basically move, check if the move is valid and undo the move if it&apos;s not.</p>
<p>If you are being clever and getting obstacles relative to theplayer, it&apos;s very important that you move the character first, then get the list of obstacles. This is because the list of obstacles will usually change based on the characters position. If the character moves you need the latest, most up to date obstacles. We&apos;re going to be clever and do this :)</p>
<p>The other option is to brute force the deal, this means checking and trying to resolve the characters collision against every collidable object all the time. This method might work for smaller games, but the list of collisions to check will quickly grow out of hand. Most of the time brute force will simply not be an option due to performance reasons. We will <strong>not</strong> be doing brute force.</p>
<h3 id="game-refactor">Game Refactor</h3>
<p>Looking at the above list of how to resolve collisions we already know how to move the character. We however don&apos;t know how to get a list of obstacles that the character can collide with. This functionality is going to be given to <strong>Game.cs</strong>.</p>
<p>We&apos;re not going to call any new functions in Game. Instead we&apos;re going to add helper functions that will be called from inside of <code>PlayerCharacter</code> we can do this because <code>Game</code> is a singleton. We&apos;re going to write two helper functions <code>GetTile</code> and <code>GetTileRect</code> both of them are going to take a <code>PointF</code> as an argument.</p>
<p>How are these new functions going to be used? Inside of <code>PlayerCharacter</code> we&apos;re going to get the tile for one of the corners of the character. If the tile is NOT walkable, we&apos;re going to get it&apos;s rectangle (again, using one of the corner points). We will try to resolve collisions against this rectangle.</p>
<p>With that, add these functions to <strong>Game.cs</strong></p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> Tile <span class="hljs-title">GetTile</span>(<span class="hljs-params">PointF pixelPoint</span>) </span>{
    <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Get the x and y indices of the tile from pixelPoint</span>
    <span class="hljs-comment">// Return the appropriate tile</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>; <span class="hljs-comment">// Just so this compiles</span>
}

<span class="hljs-function"><span class="hljs-keyword">public</span> Rectangle <span class="hljs-title">GetTileRect</span>(<span class="hljs-params">PointF pixelPoint</span>) </span>{
    <span class="hljs-comment">// <span class="hljs-doctag"><span class="hljs-keyword">TODO</span></span>: Convert pixel point into a Rectangle that is on the tile grid</span>
    <span class="hljs-comment">// Hint, xTile * tileSize = Grid X Position</span>
    <span class="hljs-comment">// return the resulting rectangle</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Rectangle(); <span class="hljs-comment">// Just so this compiles</span>
}
</code></pre>
<p>Try to fill those functions in. Let&apos;s also change how the rendering of the game works by adding more debug symbols! Change the <code>Render</code> function in <strong>Game.cs</strong> to this:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Render</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> h = <span class="hljs-number">0</span>; h &lt; map.Length; h++) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> w = <span class="hljs-number">0</span>; w &lt; map[h].Length; w++) {
            map[h][w].Render();
        }
    }

    <span class="hljs-keyword">foreach</span> (PointF corner <span class="hljs-keyword">in</span> hero.Corners) {
        <span class="hljs-keyword">if</span> (GetTile(corner).Walkable) {
            GraphicsManager.Instance.DrawRect(GetTileRect(corner), Color.Blue);
        }
        <span class="hljs-keyword">else</span> {
            GraphicsManager.Instance.DrawRect(GetTileRect(corner), Color.Violet);
        }
    }

    hero.Render();
}
</code></pre>
<p>This render function actually demonstrates HOW we&apos;re going to use the <code>GetTile</code> and <code>GetTileRect</code> functions. Any tile that one of the player corners falls on is colored Blue or Violet. Blue tiles are walkable, Violet ones are not. When it comes time to Resolve Collisions, we only have to check the violet tiles. Checking so few tiles will make our game super performant. </p>
<p>Running your game, you should get something like the below screenshot. The blue / violet squares might not always be evenly distributed. That is at some points you might only see 2 tiles get colored. Walk around, you should see a few patterns.</p>
<p><img src="Images/wallscreen3.PNG" alt="SCREEN"></p>
<h3 id="refactoring-playercharacter">Refactoring PlayerCharacter</h3>
<p>Now comes the fun part. We&apos;re actually going to resolve collisions! <strong>BUT FIRST</strong>, lets do some house keeping! Let&apos;s make it so that the character can walk both up/down AND left/right at the same time. Inside <strong>PLayerCharacter.cs</strong> find and change:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">else</span> <span class="hljs-title">if</span> (<span class="hljs-params">i.KeyDown(OpenTK.Input.Key.W</span>) || i.<span class="hljs-title">KeyDown</span>(<span class="hljs-params">OpenTK.Input.Key.Up</span>)) </span>{
</code></pre>
<p>to</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (i.KeyDown(OpenTK.Input.Key.W) || i.KeyDown(OpenTK.Input.Key.Up)) {
</code></pre>
<p>The way we do animations now is good, but an animation frame might change the Width / Height of our sprite. If the width or height is going to change, we want that to happen sooner, rather than later. Inside <strong>PlayerCharacter.cs</strong> we have a variable <code>bool animating = false;</code> Remove that.</p>
<p>Find the animation code at the bottom of <code>Update</code> and remove it. We&apos;re going to refactor it into an <code>Animate</code> function, this is what it&apos;s going to look like:</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Animate</span>(<span class="hljs-params"><span class="hljs-keyword">float</span> deltaTime</span>) </span>{
    animTimer += deltaTime;
    <span class="hljs-keyword">if</span> (animTimer &gt; animFPS) {
        currentFrame += <span class="hljs-number">1</span>;
        animTimer -= animFPS;
        <span class="hljs-keyword">if</span> (currentFrame &gt; SpriteSource[currentSprite].Length - <span class="hljs-number">1</span>) {
            currentFrame = <span class="hljs-number">0</span>;
        }
    }
}
</code></pre>
<p>Again, inside of the <code>Update</code> function replace everywhere aimation is set to true <code>animating = true;</code> to a call to Animate <code>Animate(deltaTime</code>.</p>
<p><strong>Run the game</strong> it should at this point run as expected. Now it&apos;s time to resolve some collisions! The key to efficient collision resolution is to check as few things as possible. As long as the character is the same size or smaller than the tiles there can be at most two collisions at a time:</p>
<p><img src="Images/collisions.png" alt="SCREEN"></p>
<p>When link is moving in one direction, only his corners in that direction need to be checked. And it&apos;s not even his corners, it&apos;s the tile his corners fall on. In the middle example above, both the top and bottom corners fall on the same tile, so only one is checked. Here is a breakdown of which corners to check:</p>
<ul>
<li>Moving Left<ul>
<li>Check Top Left Corner</li>
<li>Check Bottom Left Corner</li>
</ul>
</li>
<li>Moving Right<ul>
<li>Check Top Right Corner</li>
<li>Check Bottom Right Corner</li>
</ul>
</li>
<li>Moving Up<ul>
<li>Check Top Left Corner</li>
<li>Check Top Right Corner</li>
</ul>
</li>
<li>Moving Down<ul>
<li>Check Bottom Left Corner</li>
<li>Check Bottom Right Corner</li>
</ul>
</li>
</ul>
<p>How do we actually go about checking these? Let&apos;s walk trough adding collision resolution when moving left. First, locate the code that moves link left:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (i.KeyDown(OpenTK.Input.Key.A) || i.KeyDown(OpenTK.Input.Key.Left)) {
    SetSprite(<span class="hljs-string">&quot;Left&quot;</span>);
    Animate(deltaTime);
    positionCpy.X -= speed * deltaTime;

    <span class="hljs-comment">// Add collision resolution</span>
}
</code></pre>
<ul>
<li>To add collision resolution, first lets check the TopLeftCorner. </li>
<li>Use the Game class to get the tile at the top left corners Point</li>
<li>Check to see if the tile is walkable. IF NOT:<ul>
<li>Get the intersection rectangle of the player and the tile</li>
<li>An intersection happens if the intersection rect has an area &gt; 0</li>
<li>Check if intersect.W * intersect.H &gt; 0, IF IT IS:<ul>
<li>Clamp player X to intersection rectangle right</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Let&apos;s see what this would look like in code:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
    Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
    <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// W * H == 0 if NO intersection happened!</span>
        Position.X = intersection.Right;
    }
}
</code></pre>
<p>We don&apos;t need to fully qualify <code>Rect</code>, <code>Corner</code> or <code>CORNER_TOP_LEFT</code> because we inherited them from <code>Character</code>. We can access the helper functions of <code>Game</code> trough it&apos;s singleton instance. </p>
<p>That takes care of the top left collision of moving left, we need to also check bottom left. It&apos;s going to more or less be the same code. Here is the entire key checker part of the code:</p>
<pre><code class="lang-cs"><span class="hljs-keyword">if</span> (i.KeyDown(OpenTK.Input.Key.A) || i.KeyDown(OpenTK.Input.Key.Left)) {
    SetSprite(<span class="hljs-string">&quot;Left&quot;</span>);
    Animate(deltaTime);
    Position.X -= speed * deltaTime;

    <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_TOP_LEFT]).Walkable) {
        Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_TOP_LEFT]));
        <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// W * H == 0 if NO intersection happened!</span>
            Position.X = intersection.Right;
        }
    }

    <span class="hljs-keyword">if</span> (!Game.Instance.GetTile(Corners[CORNER_BOTTOM_LEFT]).Walkable) {
        Rectangle intersection = Intersections.Rect(Rect, Game.Instance.GetTileRect(Corners[CORNER_BOTTOM_LEFT]));
        <span class="hljs-keyword">if</span> (intersection.Width * intersection.Height &gt; <span class="hljs-number">0</span>) { <span class="hljs-comment">// W * H == 0 if NO intersection happened!</span>
            Position.X = intersection.Right;
        }
    }
}
</code></pre>
<p><strong>Run the game</strong>, walking to the left collisions should now happen. But you can walk trough tiles in any other direction. Go ahead and add collision resolution code to the rest of the movement directions. Keep in mind:</p>
<ul>
<li>Do walking Up after the Left sample. Up is easyer than Right</li>
<li>When handling Right &amp; Down, keep in mind that the players position 0,0 is top right<ul>
<li>You will have to subtract player width or height from the clamp position</li>
</ul>
</li>
</ul>
<h3 id="smooth-movement">Smooth movement</h3>
<p>Right now walking around you can kind of get stuck in the wall at random spots. We can fix that. You get stuck in walls because the animation method changes the height of the player sprite. So we do collision checking on one frame with one height, but then turning left will change the height. Changing the height between aniamtions causes us to get stuck. It&apos;s an easy fix, find this code in <strong>PlayerCharacter.cs</strong></p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PlayerCharacter</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> spritePath, Point pos</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">spritePath, pos</span>) </span>{
    AddSprite(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">59</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">87</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Up&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">115</span>, <span class="hljs-number">3</span>, <span class="hljs-number">22</span>, <span class="hljs-number">28</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">141</span>, <span class="hljs-number">3</span>, <span class="hljs-number">22</span>, <span class="hljs-number">28</span>));
    AddSprite(<span class="hljs-string">&quot;Left&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">31</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">31</span>));
    AddSprite(<span class="hljs-string">&quot;Right&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">195</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">167</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">29</span>));
    SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
}
</code></pre>
<p>And change it to have a uniform height</p>
<pre><code class="lang-cs"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PlayerCharacter</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> spritePath, Point pos</span>) : <span class="hljs-title">base</span>(<span class="hljs-params">spritePath, pos</span>) </span>{
    AddSprite(<span class="hljs-string">&quot;Down&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">59</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">87</span>, <span class="hljs-number">1</span>, <span class="hljs-number">24</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Up&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">115</span>, <span class="hljs-number">3</span>, <span class="hljs-number">22</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">141</span>, <span class="hljs-number">3</span>, <span class="hljs-number">22</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Left&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">31</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>));
    AddSprite(<span class="hljs-string">&quot;Right&quot;</span>, <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">195</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>), <span class="hljs-keyword">new</span> Rectangle(<span class="hljs-number">167</span>, <span class="hljs-number">1</span>, <span class="hljs-number">26</span>, <span class="hljs-number">30</span>));
    SetSprite(<span class="hljs-string">&quot;Down&quot;</span>);
}
</code></pre>
<p><strong>DONE</strong>, Run the game. Moving is smooth as a button and collisions work correctly in all directions.</p>
<h2 id="check-in">Check in</h2>
<p>Check in with me when you finished this part before moving onto the next bit. I want to review the code written up to this point.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./Practice/PracticeMoving.html" class="navigation navigation-prev " aria-label="Previous page: On Your Own"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./Chapter11.html" class="navigation navigation-next " aria-label="Next page: Open The Door"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
